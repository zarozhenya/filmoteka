{"mappings":"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","sources":["src/index.js","src/js/loader.js"],"sourcesContent":["import { getMoviesMarkup } from './js/templates';\nimport genres from './js/genres';\nimport { readMovies, createMovies, updateMovies } from './js/crud';\nimport { Loader } from './js/loader';\nimport { showMessage } from './js/showMessage';\n\nimport {\n  API_KEY,\n  BASE_URL,\n  BASE_IMG,\n  WATCHED_KEY,\n  QUEUE_KEY,\n} from './js/constants';\n\nconst refs = {\n  form: document.querySelector('form.header__form'),\n  gallery: document.querySelector('.movies-gallery'),\n  loadMoreBtn: document.querySelector('.js-load-more-btn'),\n  backdrop: document.querySelector('.backdrop'),\n  modalCloseBtn: document.querySelector('button.js-modal-close'),\n  watchedBtn: document.querySelector('.js-watched-btn'),\n  queueBtn: document.querySelector('.js-queue-btn'),\n};\n\nlet items = [];\nlet page = 1;\nlet query = '';\nlet currentResult = 0;\nlet totalResults = 0;\nlet searchByQuery = false;\nconst loader = new Loader();\n\nconst showButton = () => {\n  refs.loadMoreBtn.classList.remove('hidden');\n};\nconst hideButton = () => {\n  refs.loadMoreBtn.classList.add('hidden');\n};\n\nconst onBackdropClick = e => {\n  if (e.target.classList.contains('backdrop')) {\n    hideModal();\n  }\n};\n\n// const onKeyPress = e => {\n//   console.log(e.code);\n//   console.log(e.key);\n// };\n\nconst showModal = () => {\n  refs.backdrop.classList.remove('is-hidden');\n  refs.backdrop.addEventListener('click', onBackdropClick);\n  // document.body.addEventListener('keydown', onKeyPress);\n};\nconst hideModal = () => {\n  refs.backdrop.classList.add('is-hidden');\n  refs.backdrop.removeEventListener('click', onBackdropClick);\n};\n\nconst reset = () => {\n  page = 1;\n  query = '';\n  currentResult = 0;\n  totalResults = 0;\n  items = [];\n  showButton();\n};\n\nconst loadTrendingMovies = async () => {\n  const res = await fetch(\n    `${BASE_URL}/trending/movie/week?api_key=${API_KEY}&page=${page}`\n  );\n  const data = await res.json();\n  currentResult += data.results.length;\n  totalResults = data.total_results;\n  if (currentResult === totalResults) {\n    hideButton();\n  }\n  items = [...items, ...data.results];\n};\n\nconst loadMoviesByQuery = async () => {\n  const res = await fetch(\n    `${BASE_URL}/search/movie?api_key=${API_KEY}&query=${query}&page=${page}`\n  );\n  const data = await res.json();\n  currentResult += data.results.length;\n  totalResults = data.total_results;\n  if (currentResult === totalResults) {\n    hideButton();\n  }\n  items = [...items, ...data.results];\n};\n\nconst renderItems = () => {\n  const markup = getMoviesMarkup(items);\n  refs.gallery.innerHTML = markup;\n};\n\nconst renderModal = idMovie => {\n  const {\n    poster_path,\n    title,\n    vote_average,\n    vote_count,\n    popularity,\n    original_title,\n    genre_ids,\n    overview,\n    id,\n  } = items.find(({ id }) => id === Number(idMovie));\n  refs.backdrop.querySelector('.js-img').src = poster_path\n    ? `${BASE_IMG}${poster_path}`\n    : 'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg';\n  refs.backdrop.querySelector('.js-title').textContent = title;\n  refs.backdrop.querySelector('.js-rating').textContent =\n    vote_average.toFixed(2);\n  refs.backdrop.querySelector('.js-votes').textContent = vote_count;\n  refs.backdrop.querySelector('.js-popularity').textContent =\n    popularity.toFixed(2);\n  refs.backdrop.querySelector('.js-original').textContent = original_title;\n  refs.backdrop.querySelector('.js-genre').textContent =\n    genre_ids.length !== 0\n      ? genre_ids\n          .map(idGenre => genres.find(({ id }) => id === idGenre).name)\n          .join(', ')\n      : 'No information';\n  refs.backdrop.querySelector('.js-text').textContent = overview;\n  refs.backdrop.querySelector('.js-modal').dataset.id = id;\n};\n\nconst onFormSubmit = async e => {\n  e.preventDefault();\n  reset();\n  searchByQuery = true;\n  query = e.currentTarget.elements.query.value;\n  if (query) {\n    await onLoadMore();\n  }\n};\n\nconst onLoadMore = async () => {\n  loader.show();\n  if (searchByQuery) {\n    await loadMoviesByQuery();\n\n    page += 1;\n  } else {\n    page += 1;\n    await loadTrendingMovies();\n  }\n  loader.hide();\n  renderItems();\n};\n\nconst onGalleryClick = e => {\n  const element = e.target;\n  const id = element.closest('li').dataset.id;\n  renderModal(id);\n  showModal();\n};\n\nconst onWatchedBtnClick = e => {\n  const movieId = e.currentTarget.closest('.js-modal').dataset.id;\n  const movieData = items.find(({ id }) => id === Number(movieId));\n\n  const watchedMovies = readMovies(WATCHED_KEY);\n  const queueMovies = readMovies(QUEUE_KEY);\n  if (\n    watchedMovies?.find(({ id }) => id === Number(movieId)) ||\n    queueMovies?.find(({ id }) => id === Number(movieId))\n  ) {\n    showMessage({\n      type: 'failure',\n      message: `'${movieData.title}' has already been added to Library`,\n    });\n    hideModal();\n    return;\n  }\n  if (!watchedMovies) {\n    createMovies(WATCHED_KEY, movieData);\n    showMessage({\n      type: 'success',\n      message: `'${movieData.title}' is added to 'Watched'`,\n    });\n    hideModal();\n    return;\n  }\n\n  updateMovies(WATCHED_KEY, movieData);\n  showMessage({\n    type: 'success',\n    message: `'${movieData.title}' is added to 'Watched'`,\n  });\n  hideModal();\n};\n\nconst onQueueBtnClick = e => {\n  const movieId = e.currentTarget.closest('.js-modal').dataset.id;\n  const movieData = items.find(({ id }) => id === Number(movieId));\n\n  const queueMovies = readMovies(QUEUE_KEY);\n  const watchedMovies = readMovies(WATCHED_KEY);\n  if (\n    queueMovies?.find(({ id }) => id === Number(movieId)) ||\n    watchedMovies?.find(({ id }) => id === Number(movieId))\n  ) {\n    showMessage({\n      type: 'failure',\n      message: `'${movieData.title}' has already been added to Library`,\n    });\n    hideModal();\n    return;\n  }\n  if (!queueMovies) {\n    createMovies(QUEUE_KEY, movieData);\n    showMessage({\n      type: 'success',\n      message: `'${movieData.title}' is added to 'Queue'`,\n    });\n    hideModal();\n    return;\n  }\n\n  updateMovies(QUEUE_KEY, movieData);\n  showMessage({\n    type: 'success',\n    message: `'${movieData.title}' is added to 'Queue'`,\n  });\n  hideModal();\n};\n\nrefs.form.addEventListener('submit', onFormSubmit);\nrefs.loadMoreBtn.addEventListener('click', onLoadMore);\nrefs.gallery.addEventListener('click', onGalleryClick);\nrefs.modalCloseBtn.addEventListener('click', hideModal);\nrefs.watchedBtn.addEventListener('click', onWatchedBtnClick);\nrefs.queueBtn.addEventListener('click', onQueueBtnClick);\n\nloadTrendingMovies().then(renderItems);\n","import { Loading } from 'notiflix';\n\nexport class Loader {\n  constructor() {\n    Loading.init({\n      backgroundColor: 'rgba(0, 0, 0, 0.25)',\n      svgColor: '#ff6b01',\n    });\n  }\n  show() {\n    Loading.standard();\n  }\n  hide() {\n    Loading.remove();\n  }\n}\n"],"names":["$7sOwA","parcelRequire","$eWCmQ","$1f0dc3b9307be026$var$refs","form","document","querySelector","gallery","loadMoreBtn","backdrop","modalCloseBtn","watchedBtn","queueBtn","$1f0dc3b9307be026$var$items","$1f0dc3b9307be026$var$page","$1f0dc3b9307be026$var$query","$1f0dc3b9307be026$var$currentResult","$1f0dc3b9307be026$var$totalResults","$1f0dc3b9307be026$var$searchByQuery","$1f0dc3b9307be026$var$loader","show","Loading","standard","hide","remove","constructor","init","backgroundColor","svgColor","$1f0dc3b9307be026$var$hideButton","classList","add","$1f0dc3b9307be026$var$onBackdropClick","e","target","contains","$1f0dc3b9307be026$var$hideModal","removeEventListener","$1f0dc3b9307be026$var$reset","$1f0dc3b9307be026$var$loadTrendingMovies","async","res","fetch","$8G1wF","BASE_URL","API_KEY","data","json","results","length","total_results","$1f0dc3b9307be026$var$renderItems","markup","getMoviesMarkup","innerHTML","$1f0dc3b9307be026$var$onLoadMore","$1f0dc3b9307be026$var$loadMoviesByQuery","addEventListener","preventDefault","currentTarget","elements","query","value","idMovie","poster_path","title","vote_average","vote_count","popularity","original_title","genre_ids","overview","id","id1","find","Number","src","BASE_IMG","textContent","toFixed","map","idGenre","$ezyJp","default","name","join","dataset","$1f0dc3b9307be026$var$renderModal","closest","movieId","movieData","watchedMovies","$3nphs","readMovies","WATCHED_KEY","queueMovies","QUEUE_KEY","$2PXHr","showMessage","type","message","updateMovies","createMovies","then"],"version":3,"file":"index.4fa390c0.js.map"}